{# @var gateway brightlabs\securepay\gateways\Gateway #}
{# @var paymentForm brightlabs\securepay\models\SecurePayPaymentForm #}

{# CSS asset bundle is registered in Gateway.php #}
{# Register CSS custom properties for dynamic gateway settings #}
{% do view.registerCss("
    :root {
        --securepay-bg-color: #" ~ gateway.backgroundColour ~ ";
        --securepay-label-font-family: " ~ gateway.labelFontFamily ~ ";
        --securepay-label-font-size: " ~ gateway.labelFontSize ~ ";
        --securepay-label-font-color: #" ~ gateway.labelFontColour ~ ";
        --securepay-input-font-family: " ~ gateway.inputFontFamily ~ ";
        --securepay-input-font-size: " ~ gateway.inputFontSize ~ ";
        --securepay-input-font-color: #" ~ gateway.inputFontColour ~ ";
    }
") %}

{% import "_includes/forms" as forms %}
{% if gateway.isCredentialValid %}
    <div class="securepay-payment-form" id="securepay-payment-form">
        {% if gateway.threeDSecure %}
            <div class="input-wrapper">
                <label for="cardholderName">CardHolder name</label>
                <div class="cc-number-error"><p>Please enter card holder name</p></div>
                <input maxlength="255" id="cardholderName" class="securepayCardholderName" name="cardholderName" required="" tabindex="1" title="Enter your card number" type="text">
            </div>
            <iframe id="3ds-v2-challenge-iframe" class="_3ds-v2-challenge-iframe" name="3ds-v2-challenge-iframe" style="width:100%;height:0px"></iframe>
        {% endif %}
        {# SecurePay UI Component Container #}
        <div id="securepay-card-component" class="securepay-card-component">
            {# This will be populated by the SecurePay JavaScript SDK #}
        </div>
        {# Hidden fields for Craft Commerce form submission #}
        <input type="hidden" name="cardToken" class="securepayCardToken" value="">
        <input type="hidden" name="cardExpiryMonth" class="securepayCardExpiryMonth" value="">
        <input type="hidden" name="cardExpiryYear" class="securepayCardExpiryYear" value="">
        <input type="hidden" name="cardBin" class="securepayCardBin" value="">
        <input type="hidden" name="cardLast4" class="securepayCardLast4" value="">
        <input type="hidden" name="cardScheme" class="securepayCardScheme" value="">
        <input type="hidden" name="cardCreatedAt" class="securepayCardCreatedAt" value="">

        {# Payment processing status #}
        <div id="payment-processing" class="payment-processing" style="display: none;">
            <div class="spinner"></div>
            <p>{{ 'Processing your payment...'|t('commerce') }}</p>
        </div>
        <div class="errors"></div>
    </div>
{% else %}    
<div class="securepay-error-message">
    <div class="error-icon">⚠️</div>
    <h3>Payment Gateway Configuration Error</h3>
    <p>We're unable to process payments at the moment due to a configuration issue with our payment gateway. Please contact our support team to resolve this issue.</p>
    <p><strong>Error:</strong> Invalid SecurePay credentials detected. Please verify your gateway configuration in the admin panel.</p>
</div>
{% endif %}